#placeholder for ansible automation playbook for MDS project
- hosts:
    - sds
  tasks:
    - git:
        repo: 'https://github.com/klawrencegupta-splunk/sds.git'
        dest: /opt/git_repo
      become: yes
      become_user: root
    - name: check if links exist
      stat: 
      path: /opt/splunk/etc/system/local/serverclass.conf
      register: serverclass
    - name: Create symlink - file module not working
      shell: cd /opt/splunk/etc/deployment-apps; ln -s /opt/git_repo/* .
      become: yes
      become_user: root
      when: serverclass.stat.exists == true
    - name: link serverclass.conf to local for precedence
      shell: cd /opt/splunk/etc/system/local; ln -s /opt/git_repo/serverclass.conf .
      when: serverclass.stat.exists == true
      become: yes
      become_user: root
